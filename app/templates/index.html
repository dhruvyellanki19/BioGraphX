<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BioGraphX - Biomedical AI Assistant</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
</head>

<body>
    <!-- Main Chat Interface -->
    <div class="chat-container">
        <!-- Left Sidebar - Chat -->
        <div class="chat-sidebar">
            <div class="chat-header">
                <div class="chat-title">
                    <i class="fas fa-dna"></i>
                    <span>BioGraphX</span>
                </div>
                <div class="chat-subtitle">
                    Biomedical AI Assistant
                </div>
            </div>

            <!-- Chat Messages Container -->
            <div class="chat-messages" id="chatMessages">
                <!-- Welcome Message -->
                <div class="message assistant">
                    <div class="message-content">
                        <div class="assistant-icon">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div class="message-text">
                            <h4>Welcome to BioGraphX!</h4>
                            <p>I'm your biomedical AI assistant powered by a sophisticated 7-agent pipeline with
                                fine-tuned Qwen model. I can help
                                you with:</p>
                            <ul>
                                <li>Disease information and mechanisms</li>
                                <li>Treatment options and drug interactions</li>
                                <li>Research literature insights with evidence</li>
                                <li>Medical knowledge from Wikipedia and PubMed</li>
                            </ul>
                            <p><strong>Try asking:</strong> "What is diabetes?" or "How does metformin work?"</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Chat Input -->
            <div class="chat-input-container">
                <div class="chat-input-wrapper">
                    <textarea id="chatInput" placeholder="Ask a biomedical question..." rows="1"
                        maxlength="1000"></textarea>
                    <button id="sendButton" class="send-button">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
                <div class="input-footer">
                    <span class="character-count" id="charCount">0/1000</span>
                    <div class="example-buttons">
                        <button class="example-btn" data-question="What is diabetes?">Example 1</button>
                        <button class="example-btn" data-question="What are the treatments for asthma?">Example
                            2</button>
                        <button class="example-btn" data-question="How does metformin work?">Example 3</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Panel - Agent Outputs -->
        <div class="agent-panel">
            <div class="panel-header">
                <h3><i class="fas fa-cogs"></i> Agent Analysis</h3>
                <button class="panel-toggle" id="panelToggle">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>

            <div class="panel-content" id="panelContent">
                <div class="panel-placeholder">
                    <i class="fas fa-robot fa-2x"></i>
                    <p>Agent outputs will appear here when you ask a question</p>
                </div>

                <!-- Processing Indicator -->
                <div class="processing-indicator" id="processingIndicator" style="display: none;">
                    <div class="processing-header">
                        <i class="fas fa-cog fa-spin"></i>
                        <span>Processing through 7-agent pipeline...</span>
                    </div>
                    <div class="agent-steps" id="agentSteps">
                        <div class="agent-step" data-agent="question">
                            <i class="fas fa-microscope"></i>
                            <span>QuestionAgent: Extracting entities...</span>
                        </div>
                        <div class="agent-step" data-agent="normalize">
                            <i class="fas fa-filter"></i>
                            <span>NormalizeAgent: Normalizing entities...</span>
                        </div>
                        <div class="agent-step" data-agent="wikipedia">
                            <i class="fas fa-wikipedia-w"></i>
                            <span>WikipediaAgent: Fetching medical knowledge...</span>
                        </div>
                        <div class="agent-step" data-agent="retriever">
                            <i class="fas fa-database"></i>
                            <span>RetrieverAgent: Retrieving evidence...</span>
                        </div>
                        <div class="agent-step" data-agent="qa">
                            <i class="fas fa-brain"></i>
                            <span>QAModelAgent: Generating answer...</span>
                        </div>
                        <div class="agent-step" data-agent="evidence">
                            <i class="fas fa-file-alt"></i>
                            <span>EvidenceAgent: Formatting citations...</span>
                        </div>
                        <div class="agent-step" data-agent="explanation">
                            <i class="fas fa-lightbulb"></i>
                            <span>ExplanationAgent: Compiling response...</span>
                        </div>
                    </div>
                </div>

                <!-- Agent Outputs -->
                <div class="agent-outputs" id="agentOutputs" style="display: none;">
                    <!-- Entities Section -->
                    <div class="output-section">
                        <div class="section-header" onclick="toggleSection('entities')">
                            <i class="fas fa-tags"></i>
                            <span>Extracted Entities</span>
                            <i class="fas fa-chevron-down toggle-icon"></i>
                        </div>
                        <div class="section-content" id="entitiesContent">
                            <div class="entities-grid" id="entitiesGrid"></div>
                        </div>
                    </div>

                    <!-- Medical Knowledge Section -->
                    <div class="output-section">
                        <div class="section-header" onclick="toggleSection('triples')">
                            <i class="fas fa-book-medical"></i>
                            <span>Medical Knowledge & Context</span>
                            <i class="fas fa-chevron-down toggle-icon"></i>
                        </div>
                        <div class="section-content" id="triplesContent">
                            <div class="triples-container">
                                <div class="graph-viz" id="graphViz">
                                    <iframe id="graphFrame" src="" style="display: none;"></iframe>
                                    <div class="graph-placeholder">
                                        <i class="fas fa-project-diagram"></i>
                                        <p>Interactive graph will appear here</p>
                                    </div>
                                </div>
                                <div class="triples-table" id="triplesTable"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Evidence Section -->
                    <div class="output-section">
                        <div class="section-header" onclick="toggleSection('evidence')">
                            <i class="fas fa-book-open"></i>
                            <span>Supporting Evidence</span>
                            <i class="fas fa-chevron-down toggle-icon"></i>
                        </div>
                        <div class="section-content" id="evidenceContent">
                            <div class="evidence-list" id="evidenceList"></div>
                        </div>
                    </div>

                    <!-- Explanation Section -->
                    <div class="output-section">
                        <div class="section-header" onclick="toggleSection('explanation')">
                            <i class="fas fa-info-circle"></i>
                            <span>Detailed Explanation</span>
                            <i class="fas fa-chevron-down toggle-icon"></i>
                        </div>
                        <div class="section-content" id="explanationContent">
                            <div class="explanation-text" id="explanationText"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay" style="display: none;">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <p>Processing your question...</p>
        </div>
    </div>

    <!-- Error Modal -->
    <div class="error-modal" id="errorModal" style="display: none;">
        <div class="error-content">
            <div class="error-header">
                <i class="fas fa-exclamation-triangle"></i>
                <span>Error</span>
                <button class="close-button" onclick="closeErrorModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="error-body" id="errorBody"></div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/chat.js') }}"></script>
</body>

</html>